<!DOCTYPE html>
<html>
<head>
  <title>Daily Commission Calculator</title>
  <style>
    body {
      background: linear-gradient(to right, #1a1a1a, #1a1a1a);
      color: #ffffff;
      font-family: 'Arial', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
  }
  .container {
    background-color: #262626;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    padding: 20px;
    width: 600px;
    text-align: center;
    animation: slideIn 1s;
}

    h1 {
        text-align: center;
        color: #ef8354;
        margin-bottom: 20px;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
        background-color: #262626;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
    }

    table th,
    table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
        color: #f9f9f9;
    }

   

    form {
        margin-top: 20px;
        background-color: #262626;
        padding: 20px;
        border-radius: 4px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }
    h1 {
      color: #ffffff;
      margin-bottom: 20px;
  }

    label {
        display: block;
        margin-bottom: 5px;
        color: #ccc;
    }

    input[type="text"],
    input[type="number"], input[type="date"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 15px;
        background-color: #262626;
        color: #fff;
        font-size: 16px;
    }
    #service{
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 15px;
      background-color: #262626;
      color: #fff;
      font-size: 16px;
    }

    input[type="submit"] {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #ef8354;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    input[type="submit"]:hover {
        background-color: #d8572a;
    }

    .result {
        margin-top: 20px;
        background-color: #262626;
        padding: 20px;
        border-radius: 4px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }

    .total-profit {
        margin-top: 20px;
        text-align: center;
        color: #1a1a2e;
    }

  
    .back-button {
      padding: 10px 20px;
      background-color: #ef8354;
      margin-top: 10px;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
  }

  .back-button:hover {
      background-color: #ef8354;
  }
  #searchSection {
    margin-top: 20px;
    text-align: right;
}

#searchInput {
    width: 70%;
    padding: 10px;
    margin-right: 10px;
    box-sizing: border-box;
    border: 1px solid #ffffff;
    border-radius: 5px;
    background-color: #262626;
    color: #ffffff;
}

#searchButton {
    background-color: #ef8354;
    color: #ffffff;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease;
}

#searchButton:hover {
    background-color: #d35400;
}
#totalProfitButton {
  padding: 10px 20px;
  font-size: 16px;
  background-color: #ef8354;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-top: 10px;
  transition: background-color 0.3s ease;
}

#totalProfitButton:hover {
  background-color:  #d35400;
}

#totalProfit {
  margin-top: 10px;
  font-size: 18px;
  color: #ffffff;
}
table th {
  background-color:#ef8354 !important;
  color: #fff;
}
  </style>
</head>
<body>
  <div class="container">
  <h1>Daily Commission Calculator</h1>

  <form id="commissionForm" onsubmit="saveCommission(event)">
    <label for="date">Date:</label>
    <input type="date" id="date" value="" required>

    <label for="phone">Phone No. (PK):</label>
    <input type="text" id="phone" pattern="\d{11}" title="Enter a valid 11-digit phone number" required>

    <label for="amount">Amount:</label>
    <input type="number" id="amount" required>

    <label for="discount">Discount on Profit (%):</label>
    <input type="number" id="discount" value="0"><br><br>
    <label for="service">Service:</label>
    <select id="service" name="service" required>
      <option value="jazzcash">JazzCash</option>
      <option value="easypaisa">Easypaisa</option>
    </select>

    <input type="submit" value="Calculate Commission">
  </form>
  <button id="totalProfitButton" onclick="calculateTotalProfit()">Calculate Total Profit</button>
  <div id="totalProfit"></div>
  <div id="searchSection">
    <input type="text" id="searchInput" placeholder="Search...">
    <button id="searchButton" onclick="searchAndHighlight()">Search</button>
</div>
  <div class="result" id="commissionResults">
    <h2>Commission Results</h2>
    <table id="commissionTable">
      <!-- Table content will be added dynamically using JavaScript -->
    </table>
    <button class="back-button" onclick="goBack()">Back</button>
  </div>
  </div>
 


<script>
  function getCurrentDate() {
    var currentDate = new Date();
    var year = currentDate.getFullYear();
    var month = String(currentDate.getMonth() + 1).padStart(2, '0');
    var day = String(currentDate.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}
  
  document.addEventListener('DOMContentLoaded', function () {
    fetchCommissions();
    var dateInput = document.getElementById('date');
    dateInput.value = getCurrentDate();
   
  });
  
  function saveCommission(event) {
    event.preventDefault(); // Prevent the default form submission behavior

    // Get form data
    var phone = document.getElementById("phone").value;
    var amount = parseFloat(document.getElementById('amount').value); // Parse the amount as a float
    var discount = parseFloat(document.getElementById('discount').value);
    var service = document.getElementById("service").value;
    var date = getCurrentDate();
   

    // Calculate profit and discountAmount
    var rawProfit = (amount / 100) - ((amount / 100) * (discount / 100));
    var profit = Math.round(rawProfit);
    if (amount < 0) {
      profit = 0; 
    }
    // Create an object to hold the data
    var commissionData = {
      date: getCurrentDate(),
        phone: phone,
        amount: amount,
        discount: discount,
        service: service,
        profit: profit,
        discountAmount: ((amount / 100) * (discount / 100)),
      
    };

    // Make an AJAX request to save the data
    fetch('/api/commissions/saveCommission', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(commissionData),
    })
    .then(response => response.json())
    .then(data => {
        // Handle the response, you can update the UI or show a success message
        console.log('Commission saved successfully:', data);
        fetchCommissions()
    })
    .catch(error => {
        console.error('Error saving commission:', error);
    });
}
function fetchCommissions() {
  fetch('/api/commissions/getCommissions')
    .then(response => response.json())
    .then(data => {
      console.log('All Commissions:', data.commissions);
      if (data.success) {
        displayCommissions(data.commissions);
      } else {
        console.error('Error fetching commissions:', data.error);
      }
    })
    .catch(error => {
      console.error('Error fetching commissions:', error);
    });
}

function displayCommissions(commissions) {
  var currentDate = getCurrentDate();
  var table = document.getElementById('commissionTable');
  table.innerHTML = ''; // Clear existing content

  // Create table headers
  var headers = ['Date', 'Phone', 'Amount', 'Profit', 'Service'];
  var headerRow = table.insertRow();
  headers.forEach(header => {
    var cell = headerRow.insertCell();
    cell.innerHTML = `<b>${header}</b>`;
  });

  // Create table rows for commissions with the current date
  commissions.forEach(commission => {
    if (isSameDate(commission.date, currentDate)) {
      var row = table.insertRow();
      Object.keys(commission).forEach(key => {
        var cell = row.insertCell();
        var value = key === 'date' ? formatDate(commission[key]) : commission[key];
        cell.textContent = value;
      });
    }
  });
}

// Function to check if two dates are on the same day
function isSameDate(dateString1, dateString2) {
  var date1 = new Date(dateString1).toLocaleDateString('en-US');
  var date2 = new Date(dateString2).toLocaleDateString('en-US');
  return date1 === date2;
}




  
 // console.log('Table HTML:', table.innerHTML);

 // console.log('Current Date:', currentDate);
 // console.log('Table Rows:', table.rows.length);
 // console.log('Commission Rows:', commissions.length);
//}



// Function to format the date
function formatDate(dateString) {
  var options = { year: 'numeric', month: '2-digit', day: '2-digit' };
  var formattedDate = new Date(dateString).toLocaleDateString('en-US', options);
  return formattedDate;
}

// Fetch and display commissions when the page loads
document.addEventListener('DOMContentLoaded', function () {
  fetchCommissions();
});
function searchAndHighlight() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const tableRows = document.querySelectorAll('#commissionTable tr');
  let found = false;
  tableRows.forEach(row => {
      const rowContent = row.textContent.toLowerCase();
      if (rowContent.includes(searchTerm)) {
          // Highlight the entire row or specific cells as needed
          row.style.backgroundColor = '#d35400';
          row.scrollIntoView({ behavior: 'smooth', block: 'center' });
          found = true; 
      } else {
          row.style.backgroundColor = ''; // Reset background color
      }
  });
  if (!found) {
      alert('Term not found!');
  }
}
function calculateTotalProfit() {
  const table = document.getElementById('commissionTable');
  const rows = table.querySelectorAll('tr');
  let totalProfit = 0;

  // Start from index 1 to skip the header row
  for (let i = 1; i < rows.length; i++) {
    const profitCell = rows[i].cells[3]; // Assuming profit is in the 4th column (index 3)
    totalProfit += parseFloat(profitCell.textContent) || 0; // Handle NaN values
  }

  // Display the total profit below the button
  const totalProfitElement = document.getElementById('totalProfit');
  totalProfitElement.textContent = `Total Profit: ${totalProfit.toFixed(2)}`;
}
function goBack() {
  window.history.back();
}

</script>
</body>
</html>