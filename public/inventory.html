<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a2e;
            color: #fff;
            margin: 0;
            height: 100vh;
            flex-direction: column;
        }
        
        
        h2 {
            color: #ef8354;
        }
        
        .container {
                display: flex;
                flex-direction: column;
                align-items: center;
            
        }
       
        form {
            
             width: 800px;
             max-width: 100%;
             padding: 20px;
             background-color: #30475e;
             border-radius: 10px;
             box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
             animation: fadeInUp 0.8s ease-out;
             margin-bottom: 20px;
         }
        
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #f9f9f9;
        }
        
        select,
        input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #222b3e;
            color: #fff;
        }
        
        button {
            width: 100%;
            background-color: #ef8354;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: #d8572a;
        }
        
        table {
            width: 100%;
            max-width: 800px;
            border-collapse: collapse;
            background-color: #30475e;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-top: 20px;
        }
        th,
        td {
            border: 1px solid #47597e;
            padding: 14px;
            text-align: left;
            color: #f9f9f9;
            font-size: 16px;
        }
        
        th {
            background-color: #ef8354;
        }
        
        #total {
            font-weight: bold;
            margin-top: 10px;
            color: #fff;
        }
        
        nav {
            width: 150px;
            height: 100vh;
            background-color: #30475e;
            position: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            float:left;
        }

        nav img {
            width: 80%;
            margin-bottom: 20px;
        }

        nav a {
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            width: 100%;
            box-sizing: border-box;
        }

        nav a:hover {
            background-color: #ddd;
            color: black;
        }
    </style>
</head>

<body>
    <nav>
        <a href="/dashboard.html"><img src="./download.png" alt="Mobile Shop Logo"></a>
        <a href="/sales-main.html">Dashboard</a>
        <a href="/sales.html">Sales</a>
        <a href="/inventory.html">Inventory</a>
        <a href="/supplier-list.html">Supplier List</a>
        <a href="/category-list.html">Category List</a>
        <a href="/products.html">Product List</a>
    </nav>
    <div class="container">
    <h2>Stock</h2>

    <form id="inventoryForm">
        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>

        <label for="productName">Product Name:</label>
        <select id="productName" name="productName" required></select>

        <label for="supplierName">Supplier Name:</label>
        <select id="supplierName" name="supplierName" required></select>

        <label for="price">Price:</label>
        <input type="number" id="price" name="price" step="0.01" min="0" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" min="1" required>

        <button onclick="saveToDatabase(event)">Save</button>

    </form>
<!-- ... (existing HTML code) ... -->

<table id="inventoryTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Product Name</th>
            <th>Supplier Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody id="inventoryDataBody">
        <!-- Table rows will be dynamically added here -->
    </tbody>
</table>

</div>


    <!-- <p id="total">Total: 0</p> -->

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // Fetch product names and populate a dropdown
            await fetchProductNames();
            await fetchSupplierNames();
            // Set the current date in the date input field
            const currentDate = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = currentDate;
        
            // Fetch and render inventory table data
            fetchAndRenderInventoryTable();
        });
        
        async function fetchProductNames() {
            try {
                const response = await fetch('/api/products', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
        
                if (response.ok) {
                    const products = await response.json();
                    console.log('Products:', products);
        
                    const productNameSelect = document.getElementById('productName');
                    const priceInput = document.getElementById('price'); // Get the price input field
        
                    productNameSelect.innerHTML = '';
        
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.productName;
                        option.textContent = product.productName;
                        option.dataset.price = product.price; // Store the price as a data attribute
                        productNameSelect.appendChild(option);
                    });
        
                    // Update the price field when the product selection changes
                    productNameSelect.addEventListener('change', function () {
                        const selectedProduct = productNameSelect.value;
                        const selectedOption = productNameSelect.options[productNameSelect.selectedIndex];
                        const price = selectedOption.dataset.price;
                        priceInput.value = price;
                    });
                } else {
                    console.error('Failed to fetch product names');
                }
            } catch (error) {
                console.error('Error fetching product names:', error);
            }
        }
        
        async function fetchSupplierNames() {
            try {
                const response = await fetch('/fetchSupplierNames', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
        
                if (response.ok) {
                    const supplierNames = await response.json();
        
                    if (Array.isArray(supplierNames)) {
                        const supplierNameDropdown = document.getElementById('supplierName');
        
                        // Clear existing options
                        supplierNameDropdown.innerHTML = '';
        
                        supplierNames.forEach(supplierName => {
                            const option = document.createElement('option');
                            option.value = supplierName;
                            option.textContent = supplierName; // Set both value and text
                            supplierNameDropdown.appendChild(option);
                        });
                    } else {
                        console.error('Invalid response format. Expected an array.');
                    }
                } else {
                    console.error('Failed to fetch supplier names');
                }
            } catch (error) {
                console.error('Error fetching supplier names:', error);
            }
        }
        
    
        async function saveToDatabase() {
            event.preventDefault();
            var data = [];
            var form = document.getElementById('inventoryForm');
            var date = form.elements.date.value;
            var productName = form.elements.productName.value;
            var supplierName = form.elements.supplierName.value;
            var price = parseFloat(form.elements.price.value);
            var quantity = parseInt(form.elements.quantity.value);
            var total = (price * quantity).toFixed(2);
           
            var row = {
                date: date,
                productName: productName,
                supplierName: supplierName,
                price: price,
                quantity: quantity,
                total: parseFloat(total)
            };
        
            data.push(row);
        
            console.log('Data to be saved:', data);
        
            try {
                const response = await fetch('/saveToDatabase', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
        
                if (response.ok) {
                    console.log('Data saved to the database');
                    // Clear the form after saving
                    form.reset();
                    
                    // Clear the total
                    var totalElement = document.getElementById('total');
                    if (totalElement) {
                        totalElement.innerText = 'Total: 0.00';
                    }
                } else {
                    console.error('Failed to save data to the database');
                }
            } catch (error) {
                console.error('Error saving to the database:', error);
            }

            setTimeout(() => {
                location.reload();
            }, 1000); // Refresh after 1 second (1000 milliseconds)
        }

        
        async function fetchAndRenderInventoryTable() {
            try {
                const response = await fetch('/fetchInventoryData', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
        
                if (response.ok) {
                    const inventoryData = await response.json();
                    renderInventoryTable(inventoryData);
                } else {
                    console.error('Failed to fetch inventory data');
                }
            } catch (error) {
                console.error('Error fetching inventory data:', error);
            }
        }
        
        function renderInventoryTable(data) {
            const tableBody = document.getElementById('inventoryDataBody');
            tableBody.innerHTML = ''; // Clear existing rows
        
            data.forEach(row => {
                const newRow = tableBody.insertRow(-1);
                newRow.innerHTML = `<td>${row.date}</td>
                                    <td>${row.productName}</td>
                                    <td>${row.supplierName}</td>
                                    <td>${row.price}</td>
                                    <td>${row.quantity}</td>
                                    <td>${row.total}</td>`;
            });
        }
        
        function goBack() {
            window.history.back();
          } 
    </script>

    

</body>

</html>
